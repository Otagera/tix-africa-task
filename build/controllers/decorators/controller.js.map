{"version":3,"file":"controller.js","sourceRoot":"","sources":["../../../src/controllers/decorators/controller.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA,4BAA0B;AAE1B,6CAA4C;AAE5C,+CAA8C;AAC9C,mEAAkE;AAElE;;;;;;;;;;;;;;;;GAgBG;AAEH,SAAgB,UAAU,CAAC,WAAmB;IAC7C,OAAO,UAAS,MAAgB;QAC/B,IAAM,MAAM,GAAG,qBAAS,CAAC,WAAW,EAAE,CAAC;QACvC,KAAI,IAAI,GAAG,IAAI,MAAM,CAAC,SAAS,EAAC;YAC/B,IAAM,YAAY,GAAG,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;YAC3C,IAAM,IAAI,GAAG,OAAO,CAAC,WAAW,CAC/B,2BAAY,CAAC,IAAI,EACjB,MAAM,CAAC,SAAS,EAChB,GAAG,CACH,CAAC;YACF,IAAM,MAAM,GAAY,OAAO,CAAC,WAAW,CAC1C,2BAAY,CAAC,MAAM,EACnB,MAAM,CAAC,SAAS,EAChB,GAAG,CACH,CAAC;YACF,IAAM,WAAW,GAAG,OAAO,CAAC,WAAW,CACtC,2BAAY,CAAC,UAAU,EACvB,MAAM,CAAC,SAAS,EAChB,GAAG,CACH,IAAI,EAAE,CAAC;YACR,IAAM,iBAAiB,GAAG,OAAO,CAAC,WAAW,CAC5C,2BAAY,CAAC,SAAS,EACtB,MAAM,CAAC,SAAS,EAChB,GAAG,CACH,IAAI,EAAE,CAAC;YAER,IAAM,SAAS,GAAG,+BAAc,CAAC,iBAAiB,CAAC,CAAC;YAEpD,IAAG,IAAI,EAAC;gBACP,MAAM,CAAC,MAAM,CAAC,OAAd,MAAM,+BACL,KAAG,WAAW,GAAG,IAAM,UACpB,WAAW,KACd,SAAS;oBACT,YAAY,IACX;aACF;SACD;IACF,CAAC,CAAA;AACF,CAAC;AAtCD,gCAsCC","sourcesContent":["import 'reflect-metadata';\r\nimport { Request, Response, NextFunction, RequestHandler} from 'express';\r\nimport { AppRouter } from '../../AppRouter';\r\nimport { Methods } from './Methods';\r\nimport { MetadataKeys } from './MetadataKeys';\r\nimport { bodyValidators } from '../../middlewares/bodyValidators';\r\nimport { use } from './use';\r\n/*\r\nfunction bodyValidators(keys: string): RequestHandler {\r\n\treturn function(req: Request, res: Response, next: NextFunction){\r\n\t\tif(!req.body){\r\n\t\t\tres.status(422).send('Invalid request');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor(let key of keys) {\r\n\t\t\tif(!req.body[key]) {\r\n\t\t\t\tres.status(422).send(`Missing property ${key}`);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tnext();\r\n\t};\r\n}*/\r\n\r\nexport function controller(routePrefix: string){\r\n\treturn function(target: Function){\r\n\t\tconst router = AppRouter.getInstance();\r\n\t\tfor(let key in target.prototype){\r\n\t\t\tconst routeHandler = target.prototype[key];\r\n\t\t\tconst path = Reflect.getMetadata(\r\n\t\t\t\tMetadataKeys.path,\r\n\t\t\t\ttarget.prototype,\r\n\t\t\t\tkey\r\n\t\t\t);\r\n\t\t\tconst method: Methods = Reflect.getMetadata(\r\n\t\t\t\tMetadataKeys.method,\r\n\t\t\t\ttarget.prototype,\r\n\t\t\t\tkey\r\n\t\t\t);\r\n\t\t\tconst middlewares = Reflect.getMetadata(\r\n\t\t\t\tMetadataKeys.middleware,\r\n\t\t\t\ttarget.prototype,\r\n\t\t\t\tkey\r\n\t\t\t) || [];\r\n\t\t\tconst requiredBodyProps = Reflect.getMetadata(\r\n\t\t\t\tMetadataKeys.validator,\r\n\t\t\t\ttarget.prototype,\r\n\t\t\t\tkey\r\n\t\t\t) || [];\r\n\r\n\t\t\tconst validator = bodyValidators(requiredBodyProps);\r\n\r\n\t\t\tif(path){\r\n\t\t\t\trouter[method](\r\n\t\t\t\t\t`${routePrefix}${path}`,\r\n\t\t\t\t\t...middlewares,\r\n\t\t\t\t\tvalidator,\r\n\t\t\t\t\trouteHandler\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}"]}